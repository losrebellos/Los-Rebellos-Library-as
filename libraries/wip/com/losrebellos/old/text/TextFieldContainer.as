package com.losrebellos.old.text {	import com.losrebellos.display.base.SpritePlus;	import com.losrebellos.old.render.IRender;	import com.losrebellos.old.render.Render;	import com.losrebellos.old.render.RenderType;	import com.losrebellos.text.TextFieldAutoSizePlus;	import com.losrebellos.text.TextFieldPlus;	import flash.display.Bitmap;	import flash.display.DisplayObject;	import flash.events.FocusEvent;	import flash.events.KeyboardEvent;	import flash.geom.Rectangle;	import flash.text.AntiAliasType;	import flash.text.StyleSheet;	import flash.text.TextFieldAutoSize;	import flash.text.TextFieldType;	import flash.text.TextFormat;	import flash.text.TextLineMetrics;	/*	 *	 * @author los rebellos	 *	 */	public class TextFieldContainer extends SpritePlus implements ITextFieldContainer, IRender	{		/*		 * 		 * VARIABLES		 * 		 */		protected var _renderType:String = RenderType.NORMAL;				//fix		protected var _centerBoxWidth:Number;				//elements		protected var _bmp:Bitmap;		protected var _label:TextFieldPlus;						/*		 * 		 * CONSTRUCTOR		 * 		 */		public function TextFieldContainer()		{			super();						_label = new TextFieldPlus;			this.addChild(_label);						this.multiline = true;			this.wordWrap = true;			this.selectable = false;			this.mouse = false;			this.antiAliasType = AntiAliasType.ADVANCED;			this.embedFonts = true;		}		public static function generateTextFieldContainer(autoSize:String, styleSheet:StyleSheet):TextFieldContainer		{			var tfc:TextFieldContainer = new TextFieldContainer();			tfc.autoSize = autoSize;			tfc.styleSheet = styleSheet;						return tfc;		}						/*		 * 		 * FILTERS		 * 		 */		override public function set filters(value:Array):void		{			_label.filters = value;						updateRendering();		}		override public function get filters():Array		{			return _label.filters;		}						/*		 * 		 * RENDERING		 * 		 */		public function set renderType(value:String):void		{			_renderType = value;						updateRendering();		}		public function get renderType():String		{			return _renderType;		}		public function updateRendering():void		{			refreshPosition();			refreshRendering();		}		public function refreshPosition():void		{			switch(_label.autoSize)			{				case TextFieldAutoSize.RIGHT:					_label.x = - _label.width;					break;									case TextFieldAutoSize.CENTER:					_label.x = - _label.width / 2;					break;			}		}		public function refreshRendering():void		{			switch(_renderType)			{				case RenderType.BITMAP:					renderAsBitmap();					break;				default:					renderAsNormal();					break;			}		}		protected function renderAsBitmap():void		{			if(_bmp)				this.removeChild(_bmp);						_bmp = getLabelBitmap();			if(_bmp)			{				positionBitmap();				this.addChildAt(_bmp, 0);			}						if(_label.type != TextFieldType.INPUT)				_label.visible = false;			else			{				_label.addEventListener(FocusEvent.FOCUS_IN, keyDownHandler);				_label.addEventListener(FocusEvent.FOCUS_OUT, keyDownHandler);				_label.alpha = 0;			}		}		protected function getLabelBitmap():Bitmap		{			switch(_label.autoSize)			{				case TextFieldAutoSize.CENTER:					return Render.getBitmap(_label, new Rectangle((_centerBoxWidth - _label.boxWidth) / 2 - 1, 0, _centerBoxWidth, _label.boxHeight + 1), new RenderType);					break;								default:					return Render.getBitmap(_label, new Rectangle(0, 0, _label.boxWidth, _label.boxHeight + 1), new RenderType);					break;			}		}		protected function positionBitmap():void		{			switch(_label.autoSize)			{				case TextFieldAutoSize.CENTER:					_bmp.x = - _centerBoxWidth / 2;					break;								default:					_bmp.x = _label.x;					break;			}			_bmp.y = _label.y;		}		protected function renderAsNormal():void		{			if(_bmp)				this.removeChild(_bmp);						_label.visible = true;						if(_label.type == TextFieldType.INPUT)			{				_label.removeEventListener(FocusEvent.FOCUS_IN, keyDownHandler);				_label.removeEventListener(FocusEvent.FOCUS_OUT, keyDownHandler);				_label.removeEventListener(KeyboardEvent.KEY_DOWN, keyDownHandler);			}		}						/*		 * 		 * INPUT KEY HANDLER		 * IN CASE OF INPUT TEXTFIELD TYPE AND BITMAP RENDERING		 * 		 * "NOT WORKING AT THE MOMENT"		 * 		 */		protected function focusHandler(e:FocusEvent):void		{			if(e.type == FocusEvent.FOCUS_IN)				_label.addEventListener(KeyboardEvent.KEY_DOWN, keyDownHandler);			else if(e.type == FocusEvent.FOCUS_OUT)				_label.removeEventListener(KeyboardEvent.KEY_DOWN, keyDownHandler);		}		protected function keyDownHandler(e:KeyboardEvent):void		{			stage.focus = stage;			renderAsBitmap();			stage.focus = _label;		}				/*		 * 		 * SETTER & GETTER		 * 		 */		public function set css(value:String):void		{			_label.css = value;		}		public function get css():String		{			return _label.css;		}		public function setSimpleCSSClass(style:String, value:String):void		{			_label.setSimpleCSSClass(style, value);						this.updateRendering();		}		public function setSimpleCSSID(style:String, value:String):void		{			_label.setSimpleCSSID(style, value);						this.updateRendering();		}						/*		 * 		 * MOUSE		 * 		 */		override public function set mouse(value:Boolean):void		{			super.mouse = value;			_label.mouse = value;		}		override public function get mouse():Boolean		{			return !super.mouse && !_label.mouse;		}						/*		 * 		 * POSITION		 * 		 */		override public function set x(value:Number):void		{			super.x = value;						updateRendering();		}						/*		 * 		 * SIZE		 * 		 */		override public function set width(value:Number):void		{			_centerBoxWidth = value;			_label.width = value;						updateRendering();		}		override public function set height(value:Number):void		{			_label.height = value;						updateRendering();		}		override public function get width():Number		{			return _label.width;		}		override public function get height():Number		{			return _label.height;		}		public function get boxWidth():Number		{			return super.width;		}		public function get boxHeight():Number		{			return super.height;		}						/*		 * 		 * CLASSIC TEXTFIELD METHODS		 * 		 * like that label stay "protected"		 * encapsulation, encapsulation, encapsulation!!!		 * 		 */		public function replaceText(beginIndex : int, endIndex : int, newText : String):void		{			_label.replaceText(beginIndex, endIndex, newText);						updateRendering();		}		public function get maxScrollH() : int		{			return _label.maxScrollH;		}		public function get numLines() : int		{			return _label.numLines;		}		public function get scrollH() : int		{			return _label.scrollH;		}		public function get caretIndex() : int		{			return _label.caretIndex;		}		public function get maxScrollV() : int		{			return _label.maxScrollV;		}		public function getImageReference(id : String) : DisplayObject		{			return _label.getImageReference(id);		}		public function get scrollV() : int		{			return _label.scrollV;		}		public function get border() : Boolean		{			return _label.border;		}		public function get text() : String		{			return _label.text;		}		public function get background() : Boolean		{			return _label.background;		}		public function getCharBoundaries(charIndex : int) : Rectangle		{			return _label.getCharBoundaries(charIndex);		}		public function set borderColor(value : uint) : void		{			_label.borderColor = value;						updateRendering();		}		public function set scrollH(value : int) : void		{			_label.scrollH = value;		}		public function getFirstCharInParagraph(charIndex : int) : int		{			return _label.getFirstCharInParagraph(charIndex);		}		public function get type() : String		{			return _label.type;		}		public function replaceSelectedText(value : String) : void		{			_label.replaceSelectedText(value);						updateRendering();		}		public function getRawText() : String		{			return _label.getRawText();		}		public function get alwaysShowSelection() : Boolean		{			return _label.alwaysShowSelection;		}		public function get sharpness() : Number		{			return _label.sharpness;		}		public function get textColor() : uint		{			return _label.textColor;		}		public function set defaultTextFormat(format : TextFormat) : void		{			_label.defaultTextFormat = format;						updateRendering();		}		public function get condenseWhite() : Boolean		{			return _label.condenseWhite;		}		public function get autoSize() : String		{			return _label.autoSize;		}		public function set scrollV(value : int) : void		{			_label.scrollV = value;		}		public function set border(value : Boolean) : void		{			_label.border = value;						updateRendering();		}		public function get styleSheet() : StyleSheet		{			return _label.styleSheet;		}		public function set background(value : Boolean) : void		{			_label.background;						updateRendering();		}		public function set embedFonts(value : Boolean) : void		{			_label.embedFonts = value;						updateRendering();		}		public function get displayAsPassword() : Boolean		{			return _label.displayAsPassword;		}		public function get antiAliasType() : String		{			return _label.antiAliasType;		}		public function set multiline(value : Boolean) : void		{			_label.multiline = value;						updateRendering();		}		public function get selectionEndIndex() : int		{			return _label.selectionEndIndex;		}		public function set styleSheet(value : StyleSheet) : void		{			_label.styleSheet = value;						updateRendering();		}		public function set mouseWheelEnabled(value : Boolean) : void		{			_label.mouseWheelEnabled = value;		}		public function get selectedText() : String		{			return _label.selectedText;		}		public function get thickness() : Number		{			return _label.thickness;		}		public function getLineIndexAtPoint(x : Number, y : Number) : int		{			return _label.getLineIndexAtPoint(x, y);		}		public function appendText(newText : String) : void		{			_label.appendText(newText);		}		public function get selectionBeginIndex() : int		{			return _label.selectionBeginIndex;		}		public function set textColor(value : uint) : void		{			_label.textColor = value;						updateRendering();		}		public function set text(value : String) : void		{			_label.text = value;						updateRendering();		}		public function get bottomScrollV() : int		{			return _label.bottomScrollV;		}		public function get htmlText() : String		{			return _label.htmlText;		}		public function set alwaysShowSelection(value : Boolean) : void		{			_label.alwaysShowSelection = value;		}		public function set sharpness(value : Number) : void		{			_label.sharpness = value;						updateRendering();		}		public function get selectable() : Boolean		{			return _label.selectable;		}		public function getLineIndexOfChar(charIndex : int) : int		{			return _label.getLineIndexOfChar(charIndex);		}		public function set restrict(value : String) : void		{			_label.restrict = value;		}		public function set gridFitType(gridFitType : String) : void		{			_label.gridFitType = gridFitType;		}		public function setSelection(beginIndex : int, endIndex : int) : void		{			_label.setSelection(beginIndex, endIndex);						updateRendering();		}		public function getTextFormat(beginIndex : int = -1, endIndex : int = -1) : TextFormat		{			return _label.getTextFormat(beginIndex, endIndex);		}		public function setTextFormat(format : TextFormat, beginIndex : int = -1, endIndex : int = -1) : void		{			_label.setTextFormat(format, beginIndex, endIndex);						updateRendering();		}		public function set type(value : String) : void		{			_label.type = value;						updateRendering();		}		public function get borderColor() : uint		{			return _label.borderColor;		}		public function set condenseWhite(value : Boolean) : void		{			_label.condenseWhite = value;						updateRendering();		}		public function get textWidth() : Number		{			return _label.textWidth;		}		public function getTextRuns(beginIndex : int = 0, endIndex : int = 2147483647) : Array		{			return _label.getTextRuns(beginIndex, endIndex);		}		public function getLineOffset(lineIndex : int) : int		{			return _label.getLineOffset(lineIndex);		}		public function get wordWrap() : Boolean		{			return _label.wordWrap;		}		public function get useRichTextClipboard() : Boolean		{			return _label.useRichTextClipboard;		}		public function set autoSize(value : String) : void		{			if(value.split("/").indexOf(TextFieldAutoSizePlus.AUTO) != -1)			{				this.multiline = this.wordWrap = false;				value = value.split("/")[0];			}						_centerBoxWidth = _label.boxWidth;			_label.autoSize = value;						updateRendering();		}		public function get defaultTextFormat() : TextFormat		{			return _label.defaultTextFormat;		}		public function get multiline() : Boolean		{			return _label.multiline;		}		public function set useRichTextClipboard(value : Boolean) : void		{			_label.useRichTextClipboard = value;		}		public function set backgroundColor(value : uint) : void		{			_label.backgroundColor = value;						updateRendering();		}		public function get embedFonts() : Boolean		{			return _label.embedFonts;		}		public function set selectable(value : Boolean) : void		{			_label.selectable = value;		}		public function get textHeight() : Number		{			return _label.textHeight;		}		public function getXMLText(beginIndex : int = 0, endIndex : int = 2147483647) : String		{			return _label.getXMLText(beginIndex, endIndex);		}		public function set displayAsPassword(value : Boolean) : void		{			_label.displayAsPassword = value;						updateRendering();		}		public function getLineText(lineIndex : int) : String		{			return _label.getLineText(lineIndex);		}		public function set maxChars(value : int) : void		{			_label.maxChars = value;		}		public function get mouseWheelEnabled() : Boolean		{			return _label.mouseWheelEnabled;		}		public function get restrict() : String		{			return _label.restrict;		}		public function get gridFitType() : String		{			return _label.gridFitType;		}		public function getParagraphLength(charIndex : int) : int		{			return _label.getParagraphLength(charIndex);		}		public function set antiAliasType(antiAliasType : String) : void		{			_label.antiAliasType = antiAliasType;						updateRendering();		}		public function get backgroundColor() : uint		{			return _label.backgroundColor;		}		public function getCharIndexAtPoint(x : Number, y : Number) : int		{			return _label.getCharIndexAtPoint(x, y);		}		public function get maxChars() : int		{			return _label.maxChars;		}		public function get length() : int		{			return _label.length;		}		public function set thickness(value : Number) : void		{			_label.thickness = value;						updateRendering();		}		public function insertXMLText(beginIndex : int, endIndex : int, richText : String, pasting : Boolean = false) : void		{			_label.insertXMLText(beginIndex, endIndex, richText, pasting);		}		public function set wordWrap(value : Boolean) : void		{			_label.wordWrap = value;						updateRendering();		}		public function set htmlText(value : String) : void		{			_label.htmlText = value;						updateRendering();		}		public function getLineMetrics(lineIndex : int) : TextLineMetrics		{			return _label.getLineMetrics(lineIndex);		}		public function getLineLength(lineIndex : int) : int		{			return _label.getLineLength(lineIndex);		}	}}